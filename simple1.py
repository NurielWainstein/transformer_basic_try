import torch
import numpy as np
import math
import torch
import torch.nn as nn

from torch.utils.data import Dataset, DataLoader
from torch import nn

torch.set_printoptions(threshold=10_000)

data = [('01/01', '01/01/01'), ('02/01', '01/02/01'), ('03/01', '01/03/01'), ('04/01', '01/04/01'), ('05/01', '01/05/01'), ('06/01', '01/06/01'), ('07/01', '01/07/01'), ('08/01', '01/08/01'), ('09/01', '01/09/01'), ('10/01', '01/10/01'), ('11/01', '01/11/01'), ('12/01', '01/12/01'), ('01/02', '01/01/02'), ('02/02', '01/02/02'), ('03/02', '01/03/02'), ('04/02', '01/04/02'), ('05/02', '01/05/02'), ('06/02', '01/06/02'), ('07/02', '01/07/02'), ('08/02', '01/08/02'), ('09/02', '01/09/02'), ('10/02', '01/10/02'), ('11/02', '01/11/02'), ('12/02', '01/12/02'), ('01/03', '01/01/03'), ('02/03', '01/02/03'), ('03/03', '01/03/03'), ('04/03', '01/04/03'), ('05/03', '01/05/03'), ('06/03', '01/06/03'), ('07/03', '01/07/03'), ('08/03', '01/08/03'), ('09/03', '01/09/03'), ('10/03', '01/10/03'), ('11/03', '01/11/03'), ('12/03', '01/12/03'), ('01/04', '01/01/04'), ('02/04', '01/02/04'), ('03/04', '01/03/04'), ('04/04', '01/04/04'), ('05/04', '01/05/04'), ('06/04', '01/06/04'), ('07/04', '01/07/04'), ('08/04', '01/08/04'), ('09/04', '01/09/04'), ('10/04', '01/10/04'), ('11/04', '01/11/04'), ('12/04', '01/12/04'), ('01/05', '01/01/05'), ('02/05', '01/02/05'), ('03/05', '01/03/05'), ('05/05', '01/05/05'), ('06/05', '01/06/05'), ('07/05', '01/07/05'), ('08/05', '01/08/05'), ('09/05', '01/09/05'), ('10/05', '01/10/05'), ('11/05', '01/11/05'), ('12/05', '01/12/05'), ('01/06', '01/01/06'), ('02/06', '01/02/06'), ('03/06', '01/03/06'), ('04/06', '01/04/06'), ('05/06', '01/05/06'), ('06/06', '01/06/06'), ('07/06', '01/07/06'), ('08/06', '01/08/06'), ('09/06', '01/09/06'), ('10/06', '01/10/06'), ('11/06', '01/11/06'), ('12/06', '01/12/06'), ('01/07', '01/01/07'), ('02/07', '01/02/07'), ('03/07', '01/03/07'), ('04/07', '01/04/07'), ('05/07', '01/05/07'), ('06/07', '01/06/07'), ('07/07', '01/07/07'), ('08/07', '01/08/07'), ('09/07', '01/09/07'), ('10/07', '01/10/07'), ('11/07', '01/11/07'), ('12/07', '01/12/07'), ('01/08', '01/01/08'), ('02/08', '01/02/08'), ('03/08', '01/03/08'), ('04/08', '01/04/08'), ('05/08', '01/05/08'), ('06/08', '01/06/08'), ('07/08', '01/07/08'), ('08/08', '01/08/08'), ('09/08', '01/09/08'), ('10/08', '01/10/08'), ('11/08', '01/11/08'), ('12/08', '01/12/08'), ('01/09', '01/01/09'), ('02/09', '01/02/09'), ('03/09', '01/03/09'), ('04/09', '01/04/09'), ('05/09', '01/05/09'), ('06/09', '01/06/09'), ('07/09', '01/07/09'), ('08/09', '01/08/09'), ('09/09', '01/09/09'), ('10/09', '01/10/09'), ('11/09', '01/11/09'), ('12/09', '01/12/09'), ('01/10', '01/01/10'), ('03/10', '01/03/10'), ('04/10', '01/04/10'), ('05/10', '01/05/10'), ('06/10', '01/06/10'), ('07/10', '01/07/10'), ('08/10', '01/08/10'), ('09/10', '01/09/10'), ('10/10', '01/10/10'), ('11/10', '01/11/10'), ('12/10', '01/12/10'), ('01/11', '01/01/11'), ('02/11', '01/02/11'), ('03/11', '01/03/11'), ('04/11', '01/04/11'), ('05/11', '01/05/11'), ('06/11', '01/06/11'), ('07/11', '01/07/11'), ('08/11', '01/08/11'), ('09/11', '01/09/11'), ('10/11', '01/10/11'), ('11/11', '01/11/11'), ('12/11', '01/12/11'), ('01/12', '01/01/12'), ('02/12', '01/02/12'), ('03/12', '01/03/12'), ('04/12', '01/04/12'), ('05/12', '01/05/12'), ('06/12', '01/06/12'), ('07/12', '01/07/12'), ('08/12', '01/08/12'), ('09/12', '01/09/12'), ('10/12', '01/10/12'), ('11/12', '01/11/12'), ('12/12', '01/12/12'), ('01/13', '01/01/13'), ('02/13', '01/02/13'), ('03/13', '01/03/13'), ('04/13', '01/04/13'), ('05/13', '01/05/13'), ('06/13', '01/06/13'), ('07/13', '01/07/13'), ('08/13', '01/08/13'), ('09/13', '01/09/13'), ('10/13', '01/10/13'), ('11/13', '01/11/13'), ('12/13', '01/12/13'), ('01/14', '01/01/14'), ('02/14', '01/02/14'), ('03/14', '01/03/14'), ('04/14', '01/04/14'), ('05/14', '01/05/14'), ('07/14', '01/07/14'), ('08/14', '01/08/14'), ('09/14', '01/09/14'), ('10/14', '01/10/14'), ('11/14', '01/11/14'), ('12/14', '01/12/14'), ('01/15', '01/01/15'), ('02/15', '01/02/15'), ('03/15', '01/03/15'), ('04/15', '01/04/15'), ('05/15', '01/05/15'), ('06/15', '01/06/15'), ('07/15', '01/07/15'), ('08/15', '01/08/15'), ('09/15', '01/09/15'), ('10/15', '01/10/15'), ('11/15', '01/11/15'), ('12/15', '01/12/15'), ('01/16', '01/01/16'), ('02/16', '01/02/16'), ('03/16', '01/03/16'), ('04/16', '01/04/16'), ('05/16', '01/05/16'), ('06/16', '01/06/16'), ('07/16', '01/07/16'), ('08/16', '01/08/16'), ('09/16', '01/09/16'), ('10/16', '01/10/16'), ('11/16', '01/11/16'), ('12/16', '01/12/16'), ('01/17', '01/01/17'), ('02/17', '01/02/17'), ('03/17', '01/03/17'), ('04/17', '01/04/17'), ('05/17', '01/05/17'), ('06/17', '01/06/17'), ('07/17', '01/07/17'), ('08/17', '01/08/17'), ('09/17', '01/09/17'), ('10/17', '01/10/17'), ('11/17', '01/11/17'), ('12/17', '01/12/17'), ('01/18', '01/01/18'), ('02/18', '01/02/18'), ('03/18', '01/03/18'), ('04/18', '01/04/18'), ('05/18', '01/05/18'), ('06/18', '01/06/18'), ('07/18', '01/07/18'), ('08/18', '01/08/18'), ('09/18', '01/09/18'), ('10/18', '01/10/18'), ('11/18', '01/11/18'), ('12/18', '01/12/18'), ('01/19', '01/01/19'), ('03/19', '01/03/19'), ('04/19', '01/04/19'), ('05/19', '01/05/19'), ('06/19', '01/06/19'), ('07/19', '01/07/19'), ('08/19', '01/08/19'), ('09/19', '01/09/19'), ('10/19', '01/10/19'), ('11/19', '01/11/19'), ('12/19', '01/12/19'), ('01/20', '01/01/20'), ('02/20', '01/02/20'), ('03/20', '01/03/20'), ('04/20', '01/04/20'), ('05/20', '01/05/20'), ('06/20', '01/06/20'), ('07/20', '01/07/20'), ('08/20', '01/08/20'), ('09/20', '01/09/20'), ('10/20', '01/10/20'), ('11/20', '01/11/20'), ('12/20', '01/12/20'), ('01/21', '01/01/21'), ('02/21', '01/02/21'), ('03/21', '01/03/21'), ('04/21', '01/04/21'), ('05/21', '01/05/21'), ('06/21', '01/06/21'), ('07/21', '01/07/21'), ('08/21', '01/08/21'), ('09/21', '01/09/21'), ('10/21', '01/10/21'), ('11/21', '01/11/21'), ('12/21', '01/12/21'), ('01/22', '01/01/22'), ('02/22', '01/02/22'), ('03/22', '01/03/22'), ('04/22', '01/04/22'), ('05/22', '01/05/22'), ('06/22', '01/06/22'), ('07/22', '01/07/22'), ('08/22', '01/08/22'), ('09/22', '01/09/22'), ('10/22', '01/10/22'), ('11/22', '01/11/22'), ('12/22', '01/12/22'), ('01/23', '01/01/23'), ('02/23', '01/02/23'), ('03/23', '01/03/23'), ('04/23', '01/04/23'), ('05/23', '01/05/23'), ('06/23', '01/06/23'), ('07/23', '01/07/23'), ('08/23', '01/08/23'), ('10/23', '01/10/23'), ('11/23', '01/11/23'), ('12/23', '01/12/23'), ('01/24', '01/01/24'), ('02/24', '01/02/24'), ('03/24', '01/03/24'), ('04/24', '01/04/24'), ('05/24', '01/05/24'), ('06/24', '01/06/24'), ('07/24', '01/07/24'), ('08/24', '01/08/24'), ('09/24', '01/09/24'), ('10/24', '01/10/24'), ('11/24', '01/11/24'), ('12/24', '01/12/24'), ('01/25', '01/01/25'), ('02/25', '01/02/25'), ('03/25', '01/03/25'), ('04/25', '01/04/25'), ('05/25', '01/05/25'), ('06/25', '01/06/25'), ('07/25', '01/07/25'), ('08/25', '01/08/25'), ('09/25', '01/09/25'), ('10/25', '01/10/25'), ('11/25', '01/11/25'), ('12/25', '01/12/25'), ('01/26', '01/01/26'), ('02/26', '01/02/26'), ('03/26', '01/03/26'), ('04/26', '01/04/26'), ('05/26', '01/05/26'), ('06/26', '01/06/26'), ('07/26', '01/07/26'), ('08/26', '01/08/26'), ('09/26', '01/09/26'), ('10/26', '01/10/26'), ('11/26', '01/11/26'), ('12/26', '01/12/26'), ('01/27', '01/01/27'), ('02/27', '01/02/27'), ('03/27', '01/03/27'), ('04/27', '01/04/27'), ('05/27', '01/05/27'), ('06/27', '01/06/27'), ('07/27', '01/07/27'), ('08/27', '01/08/27'), ('09/27', '01/09/27'), ('10/27', '01/10/27'), ('11/27', '01/11/27'), ('12/27', '01/12/27'), ('01/28', '01/01/28'), ('02/28', '01/02/28'), ('03/28', '01/03/28'), ('05/28', '01/05/28'), ('06/28', '01/06/28'), ('07/28', '01/07/28'), ('08/28', '01/08/28'), ('09/28', '01/09/28'), ('10/28', '01/10/28'), ('11/28', '01/11/28'), ('12/28', '01/12/28'), ('01/29', '01/01/29'), ('02/29', '01/02/29'), ('03/29', '01/03/29'), ('04/29', '01/04/29'), ('05/29', '01/05/29'), ('06/29', '01/06/29'), ('07/29', '01/07/29'), ('08/29', '01/08/29'), ('09/29', '01/09/29'), ('10/29', '01/10/29'), ('11/29', '01/11/29'), ('12/29', '01/12/29'), ('01/30', '01/01/30'), ('02/30', '01/02/30'), ('03/30', '01/03/30'), ('04/30', '01/04/30'), ('05/30', '01/05/30'), ('06/30', '01/06/30'), ('07/30', '01/07/30'), ('08/30', '01/08/30'), ('09/30', '01/09/30'), ('10/30', '01/10/30'), ('11/30', '01/11/30'), ('12/30', '01/12/30'), ('01/31', '01/01/31'), ('02/31', '01/02/31'), ('03/31', '01/03/31'), ('04/31', '01/04/31'), ('05/31', '01/05/31'), ('06/31', '01/06/31'), ('07/31', '01/07/31'), ('08/31', '01/08/31'), ('09/31', '01/09/31'), ('10/31', '01/10/31'), ('11/31', '01/11/31'), ('12/31', '01/12/31'), ('01/32', '01/01/32'), ('02/32', '01/02/32'), ('03/32', '01/03/32'), ('04/32', '01/04/32'), ('05/32', '01/05/32'), ('06/32', '01/06/32'), ('07/32', '01/07/32'), ('08/32', '01/08/32'), ('09/32', '01/09/32'), ('10/32', '01/10/32'), ('11/32', '01/11/32'), ('12/32', '01/12/32'), ('01/33', '01/01/33'), ('03/33', '01/03/33'), ('04/33', '01/04/33'), ('05/33', '01/05/33'), ('06/33', '01/06/33'), ('07/33', '01/07/33'), ('08/33', '01/08/33'), ('09/33', '01/09/33'), ('10/33', '01/10/33'), ('11/33', '01/11/33'), ('12/33', '01/12/33'), ('01/34', '01/01/34'), ('02/34', '01/02/34'), ('03/34', '01/03/34'), ('04/34', '01/04/34'), ('05/34', '01/05/34'), ('06/34', '01/06/34'), ('07/34', '01/07/34'), ('08/34', '01/08/34'), ('09/34', '01/09/34'), ('10/34', '01/10/34'), ('11/34', '01/11/34'), ('12/34', '01/12/34'), ('01/35', '01/01/35'), ('02/35', '01/02/35'), ('03/35', '01/03/35'), ('04/35', '01/04/35'), ('05/35', '01/05/35'), ('06/35', '01/06/35'), ('07/35', '01/07/35'), ('08/35', '01/08/35'), ('09/35', '01/09/35'), ('10/35', '01/10/35'), ('11/35', '01/11/35'), ('12/35', '01/12/35'), ('01/36', '01/01/36'), ('02/36', '01/02/36'), ('03/36', '01/03/36'), ('04/36', '01/04/36'), ('05/36', '01/05/36'), ('06/36', '01/06/36'), ('07/36', '01/07/36'), ('08/36', '01/08/36'), ('09/36', '01/09/36'), ('10/36', '01/10/36'), ('11/36', '01/11/36'), ('12/36', '01/12/36'), ('01/37', '01/01/37'), ('02/37', '01/02/37'), ('03/37', '01/03/37'), ('04/37', '01/04/37'), ('05/37', '01/05/37'), ('07/37', '01/07/37'), ('08/37', '01/08/37'), ('09/37', '01/09/37'), ('10/37', '01/10/37'), ('11/37', '01/11/37'), ('12/37', '01/12/37'), ('01/38', '01/01/38'), ('02/38', '01/02/38'), ('03/38', '01/03/38'), ('04/38', '01/04/38'), ('05/38', '01/05/38'), ('06/38', '01/06/38'), ('07/38', '01/07/38'), ('08/38', '01/08/38'), ('09/38', '01/09/38'), ('10/38', '01/10/38'), ('11/38', '01/11/38'), ('12/38', '01/12/38'), ('01/39', '01/01/39'), ('02/39', '01/02/39'), ('03/39', '01/03/39'), ('04/39', '01/04/39'), ('05/39', '01/05/39'), ('06/39', '01/06/39'), ('07/39', '01/07/39'), ('08/39', '01/08/39'), ('09/39', '01/09/39'), ('10/39', '01/10/39'), ('11/39', '01/11/39'), ('12/39', '01/12/39'), ('01/40', '01/01/40'), ('02/40', '01/02/40'), ('03/40', '01/03/40'), ('04/40', '01/04/40'), ('05/40', '01/05/40'), ('06/40', '01/06/40'), ('07/40', '01/07/40'), ('08/40', '01/08/40'), ('09/40', '01/09/40'), ('10/40', '01/10/40'), ('11/40', '01/11/40'), ('12/40', '01/12/40'), ('01/41', '01/01/41'), ('02/41', '01/02/41'), ('03/41', '01/03/41'), ('04/41', '01/04/41'), ('05/41', '01/05/41'), ('06/41', '01/06/41'), ('07/41', '01/07/41'), ('08/41', '01/08/41'), ('09/41', '01/09/41'), ('10/41', '01/10/41'), ('11/41', '01/11/41'), ('12/41', '01/12/41'), ('01/42', '01/01/42'), ('03/42', '01/03/42'), ('04/42', '01/04/42'), ('05/42', '01/05/42'), ('06/42', '01/06/42'), ('07/42', '01/07/42'), ('08/42', '01/08/42'), ('09/42', '01/09/42'), ('10/42', '01/10/42'), ('11/42', '01/11/42'), ('12/42', '01/12/42'), ('01/43', '01/01/43'), ('02/43', '01/02/43'), ('03/43', '01/03/43'), ('04/43', '01/04/43'), ('05/43', '01/05/43'), ('06/43', '01/06/43'), ('07/43', '01/07/43'), ('08/43', '01/08/43'), ('09/43', '01/09/43'), ('10/43', '01/10/43'), ('11/43', '01/11/43'), ('12/43', '01/12/43'), ('01/44', '01/01/44'), ('02/44', '01/02/44'), ('03/44', '01/03/44'), ('04/44', '01/04/44'), ('05/44', '01/05/44'), ('06/44', '01/06/44'), ('07/44', '01/07/44'), ('08/44', '01/08/44'), ('09/44', '01/09/44'), ('10/44', '01/10/44'), ('11/44', '01/11/44'), ('12/44', '01/12/44'), ('01/45', '01/01/45'), ('02/45', '01/02/45'), ('03/45', '01/03/45'), ('04/45', '01/04/45'), ('05/45', '01/05/45'), ('06/45', '01/06/45'), ('07/45', '01/07/45'), ('08/45', '01/08/45'), ('09/45', '01/09/45'), ('10/45', '01/10/45'), ('11/45', '01/11/45'), ('12/45', '01/12/45'), ('01/46', '01/01/46'), ('02/46', '01/02/46'), ('03/46', '01/03/46'), ('04/46', '01/04/46'), ('05/46', '01/05/46'), ('06/46', '01/06/46'), ('07/46', '01/07/46'), ('08/46', '01/08/46'), ('10/46', '01/10/46'), ('11/46', '01/11/46'), ('12/46', '01/12/46'), ('01/47', '01/01/47'), ('02/47', '01/02/47'), ('03/47', '01/03/47'), ('04/47', '01/04/47'), ('05/47', '01/05/47'), ('06/47', '01/06/47'), ('07/47', '01/07/47'), ('08/47', '01/08/47'), ('09/47', '01/09/47'), ('10/47', '01/10/47'), ('11/47', '01/11/47'), ('12/47', '01/12/47'), ('01/48', '01/01/48'), ('02/48', '01/02/48'), ('03/48', '01/03/48'), ('04/48', '01/04/48'), ('05/48', '01/05/48'), ('06/48', '01/06/48'), ('07/48', '01/07/48'), ('08/48', '01/08/48'), ('09/48', '01/09/48'), ('10/48', '01/10/48'), ('11/48', '01/11/48'), ('12/48', '01/12/48'), ('01/49', '01/01/49'), ('02/49', '01/02/49'), ('03/49', '01/03/49'), ('04/49', '01/04/49'), ('05/49', '01/05/49'), ('06/49', '01/06/49'), ('07/49', '01/07/49'), ('08/49', '01/08/49'), ('09/49', '01/09/49'), ('10/49', '01/10/49'), ('11/49', '01/11/49'), ('12/49', '01/12/49'), ('01/50', '01/01/50'), ('02/50', '01/02/50'), ('03/50', '01/03/50'), ('04/50', '01/04/50'), ('05/50', '01/05/50'), ('06/50', '01/06/50'), ('07/50', '01/07/50'), ('08/50', '01/08/50'), ('09/50', '01/09/50'), ('10/50', '01/10/50'), ('11/50', '01/11/50'), ('12/50', '01/12/50'), ('01/51', '01/01/51'), ('03/51', '01/03/51'), ('04/51', '01/04/51'), ('05/51', '01/05/51'), ('06/51', '01/06/51'), ('07/51', '01/07/51'), ('08/51', '01/08/51'), ('09/51', '01/09/51'), ('10/51', '01/10/51'), ('11/51', '01/11/51'), ('12/51', '01/12/51'), ('01/52', '01/01/52'), ('02/52', '01/02/52'), ('03/52', '01/03/52'), ('04/52', '01/04/52'), ('05/52', '01/05/52'), ('06/52', '01/06/52'), ('07/52', '01/07/52'), ('08/52', '01/08/52'), ('09/52', '01/09/52'), ('10/52', '01/10/52'), ('11/52', '01/11/52'), ('12/52', '01/12/52'), ('01/53', '01/01/53'), ('02/53', '01/02/53'), ('03/53', '01/03/53'), ('04/53', '01/04/53'), ('05/53', '01/05/53'), ('06/53', '01/06/53'), ('07/53', '01/07/53'), ('08/53', '01/08/53'), ('09/53', '01/09/53'), ('10/53', '01/10/53'), ('11/53', '01/11/53'), ('12/53', '01/12/53'), ('01/54', '01/01/54'), ('02/54', '01/02/54'), ('03/54', '01/03/54'), ('04/54', '01/04/54'), ('05/54', '01/05/54'), ('06/54', '01/06/54'), ('07/54', '01/07/54'), ('08/54', '01/08/54'), ('09/54', '01/09/54'), ('10/54', '01/10/54'), ('11/54', '01/11/54'), ('12/54', '01/12/54'), ('01/55', '01/01/55'), ('02/55', '01/02/55'), ('03/55', '01/03/55'), ('04/55', '01/04/55'), ('05/55', '01/05/55'), ('06/55', '01/06/55'), ('07/55', '01/07/55'), ('08/55', '01/08/55'), ('09/55', '01/09/55'), ('10/55', '01/10/55'), ('12/55', '01/12/55'), ('01/56', '01/01/56'), ('02/56', '01/02/56'), ('03/56', '01/03/56'), ('04/56', '01/04/56'), ('05/56', '01/05/56'), ('06/56', '01/06/56'), ('07/56', '01/07/56'), ('08/56', '01/08/56'), ('09/56', '01/09/56'), ('10/56', '01/10/56'), ('11/56', '01/11/56'), ('12/56', '01/12/56'), ('01/57', '01/01/57'), ('02/57', '01/02/57'), ('03/57', '01/03/57'), ('04/57', '01/04/57'), ('05/57', '01/05/57'), ('06/57', '01/06/57'), ('07/57', '01/07/57'), ('08/57', '01/08/57'), ('09/57', '01/09/57'), ('10/57', '01/10/57'), ('11/57', '01/11/57'), ('12/57', '01/12/57'), ('01/58', '01/01/58'), ('02/58', '01/02/58'), ('03/58', '01/03/58'), ('04/58', '01/04/58'), ('05/58', '01/05/58'), ('06/58', '01/06/58'), ('07/58', '01/07/58'), ('08/58', '01/08/58'), ('09/58', '01/09/58'), ('10/58', '01/10/58'), ('11/58', '01/11/58'), ('12/58', '01/12/58'), ('01/59', '01/01/59'), ('02/59', '01/02/59'), ('03/59', '01/03/59'), ('04/59', '01/04/59'), ('05/59', '01/05/59'), ('06/59', '01/06/59'), ('07/59', '01/07/59'), ('08/59', '01/08/59'), ('09/59', '01/09/59'), ('10/59', '01/10/59'), ('11/59', '01/11/59'), ('12/59', '01/12/59'), ('01/60', '01/01/60'), ('02/60', '01/02/60'), ('03/60', '01/03/60'), ('04/60', '01/04/60'), ('05/60', '01/05/60'), ('07/60', '01/07/60'), ('08/60', '01/08/60'), ('09/60', '01/09/60'), ('10/60', '01/10/60'), ('11/60', '01/11/60')]

index = 0
my_dict = {}

for tup in data:
    for date_str in tup:
        date_parts = date_str.split('/')
        for part in date_parts:
            if part not in my_dict:
                tensor = torch.zeros(64)
                tensor[index] = 1
                my_dict[part] = tensor
                index += 1
for char in "/":
    tensor = torch.zeros(64)
    tensor[index] = 1
    my_dict[char] = tensor
tensor = torch.zeros(64)
tensor[index+1] = 1
my_dict["<pad>"] = tensor


def split_list(input_list):
    n = len(input_list)
    split_index = int(n * 0.8)
    trainig_data = input_list[:split_index]
    testing_data = input_list[split_index:]
    return trainig_data, testing_data


trainig_data, testing_data = split_list(data)

def parse_data(trainig_data):
    t_data = []
    for tup in trainig_data:
        current = []

        for element in tup[:2]:
            element_with_spaces = element.replace('/', ' / ')
            words = element_with_spaces.split()
            sentence_tensor = torch.zeros((64, 64))
            for i in range(64):
                sentence_tensor[i] = my_dict["<pad>"]
            for j, word in enumerate(words):
                word_tensor = my_dict[word]
                sentence_tensor[j] = word_tensor

            current.append(sentence_tensor)

        t_data.append((current[0], current[1]))
    return t_data

test_data = parse_data(testing_data)
t_data = parse_data(trainig_data)

class MyDataset(Dataset):
    def __init__(self, data):
        self.data = data

    def __len__(self):
        return len(self.data)

    def __getitem__(self, idx):
        input_value = self.data[idx][0]
        expected_output = self.data[idx][1]
        return input_value, expected_output


my_dataset = MyDataset(t_data)
batch_size = 4
my_dataloader = DataLoader(my_dataset, batch_size=batch_size, shuffle=True)

class PositionalEncoding(nn.Module):

    def __init__(self, d_model: int, dropout: float = 0.1, max_len: int = 5000):
        super().__init__()
        self.dropout = nn.Dropout(p=dropout)

        position = torch.arange(max_len).unsqueeze(1)
        div_term = torch.exp(torch.arange(0, d_model, 2) * (-math.log(10000.0) / d_model))
        pe = torch.zeros(max_len, 1, d_model)
        pe[:, 0, 0::2] = torch.sin(position * div_term)
        pe[:, 0, 1::2] = torch.cos(position * div_term)
        self.register_buffer('pe', pe)

    def forward(self, x):
        """
        Args:
            x: Tensor, shape [seq_len, batch_size, embedding_dim]
        """
        x = x + self.pe[:x.size(0)]
        return self.dropout(x)

class TransformerModel(nn.Module):
    def __init__(self, vocab_size=64, d_model=64, nhead=4, num_layers=6):
        super(TransformerModel, self).__init__()
        self.d_model = d_model
        self.encoder = nn.Embedding(d_model, d_model)
        # self.pos_encoder = PositionalEncoding(d_model, 0.1)
        self.transformer_encoder = nn.TransformerEncoder(
            nn.TransformerEncoderLayer(d_model=d_model, nhead=nhead, dropout=0.2, batch_first=True),
            num_layers=num_layers)
        self.lin = nn.Linear(d_model,d_model)
        self.softmax = nn.Softmax(dim=2)

    def forward(self, src, mask):
        # src = self.pos_encoder(src)
        out_encoder = self.transformer_encoder(src, src_key_padding_mask=mask)

        # Apply a linear layer to get the output logits
        norm = self.lin(out_encoder)
        output = self.softmax(norm)
        return output


model = TransformerModel()
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)
criterion = nn.L1Loss()

def fix_batches(tensor):
    x1, x2, x3, x4 = torch.split(tensor, 1, dim=0)
    return torch.cat((x1, x2, x3, x4), dim=0)

for epoch in range(10):
    for i, batch in enumerate(my_dataloader):
        inputs, expected_outputs = batch
        if inputs.size() == (1,64,64):
            continue
        else:
            inputs = (fix_batches(inputs)).squeeze()
            expected_outputs = (fix_batches(expected_outputs)).squeeze()
        # forward pass
        mask = torch.zeros(4, 64)
        for batch in range(4):
            for emb in range(64):
                if (inputs == my_dict["<pad>"])[batch][emb].all():
                    mask[batch][emb] = 1
        outputs = model(inputs, mask)
        loss = criterion(outputs, expected_outputs)

        # backward pass
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()

        # print progress
        if (i + 1) % 1 == 0:
            print('Epoch [{}/{}], Step [{}/{}], Loss: {:.10f}'
                  .format(epoch + 1, 10, i + 1, len(my_dataloader), loss.item()))


test_string = test_data[10][0].unsqueeze(0)
final_string = ""
with torch.no_grad():
    mask = torch.zeros(1, 64)
    for batch in range(1):
        for emb in range(64):
            if (test_string == my_dict["<pad>"])[batch][emb].all():
                mask[batch][emb] = 1
    output = model.forward(test_string, mask)
    output = output.argmax(-1).squeeze()

    for el in output:
        tensor = torch.zeros(64)
        tensor[el.item()] = 1
        for key, value in my_dict.items():
            equal = torch.eq(value, tensor)
            if equal.all():
                final_string = final_string + key
    print(final_string)

